// Auto-generated by the Load Impact converter

import "./libs/shim/core.js";
import http from 'k6/http';

export let options = { maxRedirects: 4 };

const Pre = Symbol.for("pre");
const Request = Symbol.for("request");
postman[Symbol.for("initial")]({
  options,
  collection: {
    token: ""
  }
});

export default function() {
  postman[Pre].push(() => {
    var server = "http://10.0.0.50:8080";
    var realm = "master";
    var grantType = "client_credentials";
    var clientId = "test";
    var clientSecret = "9dc03e84-6f43-4616-a24c-6cf9a54aabe2";

    var url = `${server}/auth/realms/${realm}/protocol/openid-connect/token`;
    // var data = `grant_type=${grantType}&client_id=${clientId}&client_secret=${clientSecret}`;

    var payload = {
      grant_type: grantType,
      client_id: clientId,
      client_secret: clientSecret
    };

    var params = {
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    };

    var token = http.post(url, payload, params);
    console.log(token.body);
  });

  postman[Request]({
    name: "GET - TothNET",
    id: "2d610f5d-567a-426a-8abd-75e268440121",
    method: "GET",
    address: "https://www.tothnet.hu/",
    auth(config, Var) {
      config.headers.Authorization = `Bearer ${pm[Var]("token")}`;
    }
  });

  postman[Pre].pop();
}
